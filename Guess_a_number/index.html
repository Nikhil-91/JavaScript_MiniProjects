<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton-framework/1.1.1/skeleton.css"
        integrity="sha512-bkbbtvfcVjmlzyq/v4GaSiyJY3DStQhRIbJY9D0qrheR4LgSNNzrEQcdkqdJQUbuYCkLkLCj5icLxdjxRQKsJg=="
        crossorigin="anonymous" />
    <title>Number Guess</title><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Status</title>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2>Service Status Monitor</h2>
                <div class="mb-3">
                    <select id="environmentSelect" class="form-select">
                        <option value="">Select Environment</option>
                        <option value="prod">Production</option>
                        <option value="bcp">BCP</option>
                    </select>
                    <div id="selectedUrl" class="form-text text-muted mt-1"></div>
                    <button id="fetchBtn" class="btn btn-primary mt-2">Fetch Status</button>
                </div>
                <div id="loading" class="d-none">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <div id="error" class="alert alert-danger d-none"></div>
                <div class="table-responsive">
                    <table id="statusTable" class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Hostname</th>
                                <th>Service:Port</th>
                                <th>Status</th>
                                <th>Total Services</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="4" class="text-center">No data loaded</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Environment URLs
        const URLs = {
            prod: 'https://your-prod-api-url.com/endpoint',
            bcp: 'https://your-bcp-api-url.com/endpoint'
        };

        const environmentSelect = document.getElementById('environmentSelect');
        const selectedUrl = document.getElementById('selectedUrl');
        const fetchBtn = document.getElementById('fetchBtn');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const tableBody = document.getElementById('tableBody');

        environmentSelect.addEventListener('change', updateSelectedUrl);
        fetchBtn.addEventListener('click', fetchData);

        function updateSelectedUrl() {
            const environment = environmentSelect.value;
            if (environment && URLs[environment]) {
                selectedUrl.textContent = `URL: ${URLs[environment]}`;
                selectedUrl.classList.remove('text-muted');
                selectedUrl.classList.add('text-primary');
            } else {
                selectedUrl.textContent = '';
                selectedUrl.classList.remove('text-primary');
                selectedUrl.classList.add('text-muted');
            }
        }

        async function fetchData() {
            const environment = environmentSelect.value;
            if (!environment) {
                showError('Please select an environment');
                return;
            }

            const url = URLs[environment];

            loading.classList.remove('d-none');
            error.classList.add('d-none');
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                displayData(data);
            } catch (err) {
                showError(`Error fetching data: ${err.message}`);
            } finally {
                loading.classList.add('d-none');
            }
        }

        function displayData(data) {
            tableBody.innerHTML = '';
            
            if (!data.applications || !data.applications.application) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No applications found</td></tr>';
                return;
            }

            const applications = Array.isArray(data.applications.application) 
                ? data.applications.application 
                : [data.applications.application];

            // Count services by hostname
            const hostnameCounts = {};
            
            applications.forEach(app => {
                if (app.instance) {
                    const instances = Array.isArray(app.instance) ? app.instance : [app.instance];
                    instances.forEach(instance => {
                        const instanceId = instance.instanceid || '';
                        const hostname = instanceId.split(':')[0] || 'N/A';
                        hostnameCounts[hostname] = (hostnameCounts[hostname] || 0) + 1;
                    });
                }
            });

            applications.forEach(app => {
                if (app.instance) {
                    const instances = Array.isArray(app.instance) ? app.instance : [app.instance];
                    instances.forEach(instance => {
                        const instanceId = instance.instanceid || '';
                        const parts = instanceId.split(':');
                        const hostname = parts[0] || 'N/A';
                        const servicePort = parts.length > 1 ? parts.slice(1).join(':') : 'N/A';
                        const status = instance.status || 'Unknown';
                        const serviceCount = hostnameCounts[hostname] || 0;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${hostname}</td>
                            <td>${servicePort}</td>
                            <td>
                                <span class="badge ${status.toLowerCase() === 'up' ? 'bg-success' : 'bg-danger'}">
                                    ${status}
                                </span>
                            </td>
                            <td><span class="badge bg-info">${serviceCount}</span></td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            });

            if (tableBody.children.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No instances found</td></tr>';
            }
        }

        function showError(message) {
            error.textContent = message;
            error.classList.remove('d-none');
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Error loading data</td></tr>';
        }
    </script>
</body>
</html>
</head>

<body>
    <div class="container">
        <h1>Number Guesser</h1>
        <div class="game">
            <p>Guess a Number between <span class="min-num"></span> and <span class="max-num"></span></p>
            <input type="number" id="guess-input" placeholder="Guess Your Number..">
            <input type="submit" value="submit" id="guess-btn">
            <p class="message"></p>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>
